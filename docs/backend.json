
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User Profile",
      "type": "object",
      "description": "Represents a user's public profile.",
      "properties": {
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "avatarUrl": {
            "type": "string",
            "description": "URL of the user's profile picture.",
            "format": "uri"
        },
        "jobTitle": {
            "type": "string",
            "description": "Job title of the user."
        },
        "department": {
            "type": "string",
            "description": "Department the user belongs to."
        },
        "dateOfJoining": {
            "type": "string",
            "description": "Date when the user joined the company.",
            "format": "date-time"
        },
        "employeeStatus": {
            "type": "string",
            "description": "Current status of the user (e.g., active, inactive)."
        }
      },
      "required": [
        "firstName",
        "lastName",
        "email"
      ]
    },
    "Attendance": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Attendance",
      "type": "object",
      "description": "Represents an employee's attendance record.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the attendance record."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Attendance)"
        },
        "date": {
          "type": "string",
          "description": "Date of the attendance record.",
          "format": "date-time"
        },
        "checkInTime": {
          "type": "string",
          "description": "Time when the employee checked in.",
          "format": "date-time"
        },
        "checkOutTime": {
          "type": "string",
          "description": "Time when the employee checked out.",
          "format": "date-time"
        },
        "hoursWorked": {
          "type": "number",
          "description": "Number of hours worked by the employee."
        }
      },
      "required": [
        "id",
        "employeeId",
        "date",
        "checkInTime",
        "checkOutTime",
        "hoursWorked"
      ]
    },
    "LeaveRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LeaveRequest",
      "type": "object",
      "description": "Represents a leave request submitted by an employee.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the leave request."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N LeaveRequest)"
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the leave period.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the leave period.",
          "format": "date-time"
        },
        "leaveType": {
          "type": "string",
          "description": "Type of leave requested (e.g., sick leave, vacation)."
        },
        "reason": {
          "type": "string",
          "description": "Reason for the leave request."
        },
        "status": {
          "type": "string",
          "description": "Status of the leave request (e.g., pending, approved, rejected)."
        },
        "approverId": {
          "type": "string",
          "description": "Reference to UserProfile (Manager) who approved/rejected the request. (Relationship: UserProfile 1:N LeaveRequest)"
        }
      },
      "required": [
        "id",
        "employeeId",
        "startDate",
        "endDate",
        "leaveType",
        "reason",
        "status"
      ]
    },
    "Payroll": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payroll",
      "type": "object",
      "description": "Represents an employee's payroll information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payroll record."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Payroll)"
        },
        "paymentDate": {
          "type": "string",
          "description": "Date when the payment was made.",
          "format": "date-time"
        },
        "grossSalary": {
          "type": "number",
          "description": "Gross salary of the employee."
        },
        "deductions": {
          "type": "number",
          "description": "Total deductions from the salary."
        },
        "netSalary": {
          "type": "number",
          "description": "Net salary paid to the employee."
        },
        "taxDeductions": {
          "type": "number",
          "description": "Tax deductions from the salary."
        },
        "otherDeductions": {
          "type": "number",
          "description": "Other deductions from the salary."
        }
      },
      "required": [
        "id",
        "employeeId",
        "paymentDate",
        "grossSalary",
        "deductions",
        "netSalary",
        "taxDeductions"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a message exchanged in the HR Helpdesk Chatbot.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat message."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N ChatMessage)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the message was sent.",
          "format": "date-time"
        },
        "messageText": {
          "type": "string",
          "description": "Content of the chat message."
        },
        "isEmployeeMessage": {
          "type": "boolean",
          "description": "Indicates if the message was sent by the employee or the chatbot."
        }
      },
      "required": [
        "id",
        "employeeId",
        "timestamp",
        "messageText",
        "isEmployeeMessage"
      ]
    },
    "Candidate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Candidate",
      "type": "object",
      "description": "Represents a job candidate in the recruitment process.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the candidate."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the candidate."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the candidate."
        },
        "email": {
          "type": "string",
          "description": "Email address of the candidate.",
          "format": "email"
        },
        "resumeLink": {
          "type": "string",
          "description": "Link to the candidate's resume.",
          "format": "uri"
        },
        "applicationDate": {
          "type": "string",
          "description": "Date when the candidate applied.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Current status of the candidate (e.g., applied, interviewed, hired)."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "resumeLink",
        "applicationDate",
        "status"
      ]
    },
    "Anomaly": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Anomaly",
      "type": "object",
      "description": "Represents an anomaly detected in attendance records.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the anomaly record."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Anomaly)"
        },
        "date": {
          "type": "string",
          "description": "Date when the anomaly was detected.",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "description": "Type of anomaly detected (e.g., unusual absence, late arrival)."
        },
        "description": {
          "type": "string",
          "description": "Description of the anomaly."
        },
        "severity": {
          "type": "string",
          "description": "Severity of the anomaly (e.g., low, medium, high)."
        }
      },
      "required": [
        "id",
        "employeeId",
        "date",
        "type",
        "description",
        "severity"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores public user profile information. The `userId` must match the authenticated user's UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, matching their Firebase Auth UID."
            }
          ],
          "access": {
            "read": "request.auth.uid != null",
            "list": "request.auth.uid != null",
            "write": "request.auth.uid == userId"
          }
        }
      },
      {
        "path": "/users/{userId}/attendance/{attendanceId}",
        "definition": {
          "entityName": "Attendance",
          "schema": {
            "$ref": "#/backend/entities/Attendance"
          },
          "description": "Stores attendance records for each employee. Path-based ownership for simplified security rules.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "attendanceId",
              "description": "Unique identifier for the attendance record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/leaveRequests/{leaveRequestId}",
        "definition": {
          "entityName": "LeaveRequest",
          "schema": {
            "$ref": "#/backend/entities/LeaveRequest"
          },
          "description": "Stores leave requests submitted by each employee. Path-based ownership for simplified security rules.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "leaveRequestId",
              "description": "Unique identifier for the leave request."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/payroll/{payrollId}",
        "definition": {
          "entityName": "Payroll",
          "schema": {
            "$ref": "#/backend/entities/Payroll"
          },
          "description": "Stores payroll information for each employee. Path-based ownership for simplified security rules.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "payrollId",
              "description": "Unique identifier for the payroll record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/chatMessages/{chatMessageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat messages for each employee. Path-based ownership for simplified security rules.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "chatMessageId",
              "description": "Unique identifier for the chat message."
            }
          ]
        }
      },
      {
        "path": "/candidates/{candidateId}",
        "definition": {
          "entityName": "Candidate",
          "schema": {
            "$ref": "#/backend/entities/Candidate"
          },
          "description": "Stores job candidates in the recruitment process. Top-level collection for easy enumeration.",
          "params": [
            {
              "name": "candidateId",
              "description": "Unique identifier for the candidate."
            }
          ]
        }
      },
      {
        "path": "/anomalies/{anomalyId}",
        "definition": {
          "entityName": "Anomaly",
          "schema": {
            "$ref": "#/backend/entities/Anomaly"
          },
          "description": "Stores detected anomalies in attendance records. Top-level collection for administrative access.",
          "params": [
            {
              "name": "anomalyId",
              "description": "Unique identifier for the anomaly record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to organize HR and payroll data effectively, focusing on user-centric data organization and clear ownership. Each user has their own space for attendance, leave requests, payroll, and chat messages, ensuring data privacy and simplified security rules. Candidates and anomalies are stored in root-level collections, separate from user-specific data. This segregation enhances query performance and simplifies security rules. All user-owned subcollections reside under `/users/{userId}`, thus the security rules will be straightforward, path-based and very secure. This structure achieves Authorization Independence by leveraging path-based ownership for user-specific data, eliminating the need for `get()` calls in security rules. QAPs are supported through structural segregation: listing users is done at the root level (subject to appropriate access controls), and listing attendance or leave requests is confined to the user's document, thereby securing list operations."
  }
}

    